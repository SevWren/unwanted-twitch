!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d00f7aac-c25c-4fc7-8627-41fcb77d00f4",e._sentryDebugIdIdentifier="sentry-dbid-d00f7aac-c25c-4fc7-8627-41fcb77d00f4")}catch(e){}}(),(self.webpackChunktwitch_twilight=self.webpackChunktwitch_twilight||[]).push([[48133],{399353:function(e){e.exports={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"threadListItemSpamInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WhisperSpamInfo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lastMarkedNotSpamAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"likelihood"},arguments:[],directives:[]}]}}]}},849141:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"Threads_MarkAllWhispersAsRead"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateAllWhisperThreadsInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateAllWhisperThreads"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n},598602:function(e,n,i){var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"currentUserWhisperThreadsNode"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WhisperThread"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"participants"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"chatColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"70"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"spamInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"threadListItemSpamInfo"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"messages"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"IntValue",value:"20"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"whisperThreadsMessageEdge"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userLastMessageRead"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"isMuted"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isArchived"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unreadMessagesCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]},a={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)}))}t.definitions=t.definitions.concat(r(i(399353).definitions)),t.definitions=t.definitions.concat(r(i(68771).definitions)),e.exports=t},120309:function(e,n,i){var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Whispers_Whispers_UserWhisperThreads"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cursor"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"whisperThreads"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"IntValue",value:"10"}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"cursor"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"currentUserWhisperThreadsNode"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}}]}}]},a={};function r(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&n.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,n)})),e.definitions&&e.definitions.forEach((function(e){r(e,n)}))}t.definitions=t.definitions.concat(i(598602).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})));var d={};t.definitions.forEach((function(e){if(e.name){var n=new Set;r(e,n),d[e.name.value]=n}})),e.exports=t},68771:function(e){e.exports={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"whisperThreadsMessageEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WhisperMessageEdge"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nonce"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"editedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"deletedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"from"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"from"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"to"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}},523693:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"Thread_ArchiveThread"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateWhisperThreadInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateWhisperThread"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"thread"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isArchived"},arguments:[],directives:[]}]}}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n},794955:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"Whispers_MarkThreadMessageRead"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateWhisperThreadInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateWhisperThread"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"thread"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unreadMessagesCount"},arguments:[],directives:[]}]}}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n},917524:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Whispers_Tracking_CurrentUser"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hasTurbo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"availability"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n},611564:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Whispers_Tracking_Read"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"whisperThread"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"threadID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"participants"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"whisperPermissions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"receive"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n},121614:function(e,n,i){"use strict";i.d(n,{x:function(){return m}});var t=i(331635),a=i(973421),r=i.n(a),d=i(452088),s=i(503472),o=i(120309),u=i.n(o),c=i(523693),l=i.n(c);function m(e){var n=e.id,i=(0,s.De)({threadID:n,isArchived:!0},{updateWhisperThread:{thread:{__typename:"WhisperThread",id:n,isArchived:!0},__typename:"UpdateWhisperThreadPayload"}});e.lastMessage?d.x2.apollo.client.mutate((0,t.__assign)({mutation:l()},i)):(0,s.oR)(u(),{},(function(e){var i,a;return(null===(a=null===(i=null==e?void 0:e.currentUser)||void 0===i?void 0:i.whisperThreads)||void 0===a?void 0:a.edges)?r()(e,(function(e){return e.currentUser.whisperThreads.edges}),(function(e){var i=e.find((function(e){return e.node.id===n})),a=e.filter((function(e){return e.node.id!==n}));return i?(0,t.__spreadArray)([{cursor:"0",node:(0,t.__assign)((0,t.__assign)({},i.node),{isArchived:!0}),__typename:"WhisperThreadEdge"}],a,!0):a})):e}))}},294489:function(e,n,i){"use strict";i.d(n,{W:function(){return a}});var t=i(251827);function a(e,n){return n?Object.keys(e).reduce((function(i,a){var r=e[a],d=(0,t.w)(r.participants,n);return r.muted||r.archived||!d?i:i+r.unreadMessagesCount}),0):0}},251827:function(e,n,i){"use strict";function t(e,n){return e.find((function(e){return!!e&&e.id!==n}))||void 0}i.d(n,{w:function(){return t}})},457062:function(e,n,i){"use strict";i.d(n,{p:function(){return a}});var t=i(331635),a=function(e){for(var n={},i=0,a=e;i<a.length;i++){var d=a[i],s=r(d);d.id&&s&&(n[d.id]=(0,t.__assign)({},s))}return n},r=function(e){return e.messages?{id:e.id,lastMessage:e.messages.edges.map((function(e){return e.node})).find((function(e){return!e.deletedAt}))||null,messageHistory:e.messages.edges.map((function(e){return e.node})).slice(0,-1),unreadMessagesCount:e.unreadMessagesCount,participants:e.participants.map((function(e){return e?(0,t.__assign)((0,t.__assign)({},e),{displayBadges:[],self:null}):null})),spamInfo:e.spamInfo,muted:e.isMuted,archived:e.isArchived}:null}},281993:function(e,n,i){"use strict";i.d(n,{V:function(){return f}});var t,a=i(331635),r=i(452088),d=i(503472),s=i(794955),o=i.n(s),u=i(267924),c=i(611564),l=i.n(c);function m(e){var n=function(e){try{return r.x2.apollo.client.readQuery({query:l(),variables:{threadID:e}})}catch(e){return r.vF.warn("Could not find cached whisper thread data:",e),null}}(e.threadID);if(n){var i=n.currentUser,a=n.whisperThread;if(i&&i.id&&i.login&&a){var d=a.participants.find((function(e){return!!e&&e.id!==i.id}));if(d&&d.self&&d.self.whisperPermissions){var s={conversation_id:e.threadID,message_id:null,message_uuid:e.messageID,read_mode:e.automatic?t.Focus:t.Manual,recipient_id:i.id,recipient_login:i.login,sender_id:d.id,sender_login:d.login,sender_temp_permitted:d.self.whisperPermissions.receive===u.QEK.TEMPORARY};r.E5.__track_SSRMigrationFixme("chat_whisper_read",s)}else r.vF.warn("Failed to find whisper sender in cache.")}else r.vF.warn("Failed to find required data in cache.")}}!function(e){e.Focus="focus read",e.Manual="manual read"}(t||(t={}));var v={};function f(e,n,i){var t=v[e.threadID];if(t){if(t.lastReadCursorID>=n)return;clearTimeout(t.timeoutHandle)}var s=setTimeout((function(){var n=(0,a.__assign)({mutation:o()},(0,d.De)({threadID:e.threadID,lastReadMessageID:e.lastReadMessageID},{updateWhisperThread:{thread:{__typename:"WhisperThread",id:e.threadID,unreadMessagesCount:0},__typename:"UpdateWhisperThreadPayload"}}));r.x2.apollo.client.mutate(n),delete v[e.threadID],m({automatic:i,messageID:e.lastReadMessageID,threadID:e.threadID})}),250);v[e.threadID]={timeoutHandle:s,lastReadCursorID:n}}},171742:function(e,n,i){"use strict";i.d(n,{LN:function(){return c},Nr:function(){return l},i1:function(){return f},i2:function(){return m},mY:function(){return k},yh:function(){return v}});var t=i(331635),a=i(973421),r=i.n(a),d=i(452088),s=i(99702),o=i(281993),u=i(136566);function c(e,n){if(!n.currentUser||!n.currentUser.whisperThreads||!(0,u.QK)(e))return n;var i=n.currentUser.whisperThreads.edges.find((function(n){return n.node.id===e.data_object.thread_id}));return i&&i.node.messages?r()(n,(function(e){return e.currentUser.whisperThreads.edges}),(function(n){var a=n.filter((function(n){return n.node.id!==e.data_object.thread_id}));return(0,t.__spreadArray)([i],a,!0)})):n}function l(e,n,i,a){if(!n.currentUser||!n.currentUser.whisperThreads)return n;var c=d.VS.get("whisperDoNotDisturb",!1),l=n.currentUser.whisperThreads.edges.find((function(n){return n.node.id===e.data_object.thread_id}));if(l&&l.node.messages){var m=l,v=(0,s.A6)(e);return m=r()(m,(function(e){return e.node.messages.edges}),(function(e){return(0,t.__spreadArray)([v],e,!0)})),(0,u.hQ)(e)&&(e.data_object.thread_id===i?(0,o.V)({threadID:e.data_object.thread_id,lastReadMessageID:e.data_object.message_id},e.data_object.id,!0):m=r()(m,(function(e){return e.node.unreadMessagesCount}),(function(e){return e+1})),a({threadID:e.data_object.thread_id,collapsed:!0,hidden:c})),m=r()(m,(function(e){return e.node.isArchived}),(function(){return!1})),r()(n,(function(e){return e.currentUser.whisperThreads.edges}),(function(n){var i=n.filter((function(n){return n.node.id!==e.data_object.thread_id}));return(0,t.__spreadArray)([m],i,!0)}))}return a({threadID:e.data_object.thread_id,collapsed:!0,hidden:c}),n}function m(e,n){if(!n.currentUser||!n.currentUser.whisperThreads)return n;var i=n.currentUser.whisperThreads.edges.findIndex((function(n){return n.node.id===e.data_object.thread_id}));if(i>=0){var a=n.currentUser.whisperThreads.edges[i];if(a&&a.node.messages){var d=a.node.messages.edges.findIndex((function(n){return n.node.id===e.data_object.message_id}));if(d>=0)return r()(n,(function(e,n){return e.currentUser.whisperThreads.edges[n.threadIndex].node.messages.edges[n.messageIndex].node}),(function(n){return n?(0,t.__assign)((0,t.__assign)({},n),{deletedAt:new Date(1e3*e.data_object.deleted_at).toISOString(),content:(0,t.__assign)((0,t.__assign)({},n.content),{content:e.data_object.body,emotes:(0,s.HN)(e.data_object.tags.emotes)})}):n}),{threadIndex:i,messageIndex:d})}}return n}function v(e,n){if(!n.currentUser||!n.currentUser.whisperThreads)return n;var i=n.currentUser.whisperThreads.edges.findIndex((function(n){return n.node.id===e.data_object.thread_id}));if(i>=0){var a=n.currentUser.whisperThreads.edges[i];if(a.node.messages){var d=a.node.messages.edges.findIndex((function(n){return n.node.id===e.data_object.message_id}));if(d>=0)return r()(n,(function(e,n){return e.currentUser.whisperThreads.edges[n.threadIndex].node.messages.edges[n.messageIndex].node}),(function(n){return(0,t.__assign)((0,t.__assign)({},n),{editedAt:new Date(1e3*e.data_object.edited_at).toISOString(),content:(0,t.__assign)((0,t.__assign)({},n.content),{content:e.data_object.body,emotes:(0,s.HN)(e.data_object.tags.emotes)})})}),{threadIndex:i,messageIndex:d})}}return n}function f(e,n,i){if(!n.currentUser||!n.currentUser.whisperThreads)return n;var a=n.currentUser.whisperThreads.edges.findIndex((function(n){return n.node.id===e.data_object.id}));return a>=0?(!n.currentUser.whisperThreads.edges[a].node.isArchived&&e.data_object.archived&&i(e.data_object.id),r()(n,(function(e,n){return e.currentUser.whisperThreads.edges[n.index].node}),(function(n){if(n.messages){var i=n.messages.edges,a=0;if(i.length>0){var r=i[0].cursor;a=parseInt(r,10)-e.data_object.last_read}return(0,t.__assign)((0,t.__assign)({},n),{unreadMessagesCount:a>=0?a:0,isMuted:e.data_object.muted,isArchived:e.data_object.archived})}return n}),{index:a})):n}function k(e,n){return n.currentUser&&n.currentUser.whisperThreads&&e.data_object.mark_all_read?r()(n,(function(e){return e.currentUser.whisperThreads.edges}),(function(e){return e.map((function(e){return(0,t.__assign)((0,t.__assign)({},e),{node:(0,t.__assign)((0,t.__assign)({},e.node),{unreadMessagesCount:0})})}))})):n}},988224:function(e,n,i){"use strict";i.d(n,{AK:function(){return N},IA:function(){return u},OG:function(){return F},Q7:function(){return W},TF:function(){return S},UI:function(){return b},VM:function(){return y},ZD:function(){return I},_1:function(){return d},_U:function(){return A},_k:function(){return _},e6:function(){return U},fd:function(){return C},jI:function(){return D},kl:function(){return T},qt:function(){return x},rZ:function(){return M},wO:function(){return w}});var t,a,r,d,s,o,u,c=i(331635),l=i(452088),m=i(496228),v=i(917524),f=i.n(v);function k(e){l.x2.tracking.track("chat_convo_mod",{conversation_id:e.threadID,action:e.action})}function h(e){return(0,c.__awaiter)(this,void 0,void 0,(function(){var n;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,E()];case 1:return n=i.sent(),l.x2.tracking.__track_SSRMigrationFixme("chat_ignore_client",{ui_context:e.context,from_login:n&&n.login,ignored_login:e.targetUserLogin,reason:e.reason||t.Other,source:e.source}),[2]}}))}))}function g(e,n){return(0,c.__awaiter)(this,void 0,void 0,(function(){var i;return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return[4,E()];case 1:return i=t.sent(),l.x2.tracking.track("chat_convo_mod",{conversation_id:e,action:n},{login:i&&i.login}),[2]}}))}))}function p(e){l.x2.tracking.track("chat_convo_mod_global",{action:e})}function _(){p(a.MarkAllRead)}function N(){p(a.EnableDoNotDisturb)}function S(){p(a.DisableDoNotDisturb)}function D(e,n){h({context:n,targetUserLogin:e,reason:t.Spam,source:"conversations_button"})}function b(e){g(e,s.MarkNotSpam)}function F(e){g(e,s.Archive)}function y(e){k({threadID:e,action:r.Mute})}function w(e){k({threadID:e,action:r.Unmute})}function T(e){k({threadID:e,action:r.Expand})}function I(e){k({threadID:e,action:r.Collapse})}function U(e){k({threadID:e,action:r.Close})}function x(e){k({threadID:e,action:r.Archive})}function A(e){l.x2.tracking.__track_SSRMigrationFixme("chat_convo_create",{conversation_id:e.threadID,target_login:e.targetUserlogin,source:"search_target_result",search_result_rank:e.searchResultRank})}function M(e){l.x2.tracking.track("search_click",{query:e.searchQuery,source:"conversation_list",rank:e.searchResultRank,is_conversation:e.isConversation})}function E(){var e=this;return new Promise((function(n){setTimeout((function(){return(0,c.__awaiter)(e,void 0,void 0,(function(){var e,i,t;return(0,c.__generator)(this,(function(a){switch(a.label){case 0:e=null,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,l.x2.apollo.client.query({query:f()})];case 2:return e=a.sent(),[3,4];case 3:return i=a.sent(),(0,m.nF)()?l.vF.warn("Failed to make query for current user info in WhisperSent reporting"):l.vF.errorAndReport(i,"Failed to make query for current user info in WhisperSent reporting"),[3,4];case 4:return t=e&&e.data&&e.data.currentUser,n(t),[2]}}))}))}))}))}function W(e){return(0,c.__awaiter)(this,void 0,void 0,(function(){var n;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,E()];case 1:return n=i.sent(),l.x2.tracking.__track_SSRMigrationFixme("whisper",{to:e.targetUserLogin,from:n&&n.login,player:"web",is_turbo:n&&n.hasTurbo,conversation_id:e.threadID,availability:n&&n.availability,room_type:e.inChannelChat?o.Channel:o.Conversation,ui_context:e.context}),[2]}}))}))}function C(e){return(0,c.__awaiter)(this,void 0,void 0,(function(){var n;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,E()];case 1:return n=i.sent(),l.x2.tracking.track("whisper_received",{to:n&&n.login,from:e.targetUserLogin,player:"web",is_turbo:n&&n.hasTurbo,conversation_id:e.threadID}),[2]}}))}))}!function(e){e.Harassment="Harassment",e.Spam="Spam",e.Other="Other"}(t||(t={})),function(e){e.MarkAllRead="mark_all_read",e.EnableDoNotDisturb="do_not_disturb_on",e.DisableDoNotDisturb="do_not_disturb_off"}(a||(a={})),function(e){e.Mute="mute",e.Unmute="unmute",e.Expand="maximize",e.Collapse="minimize",e.Close="close",e.Archive="archive",e.Open="open"}(r||(r={})),function(e){e.Dock="dock",e.SpamPropmt="dock_spam_cta"}(d||(d={})),function(e){e.Archive="archive",e.MarkNotSpam="mark_not_spam"}(s||(s={})),function(e){e.Channel="channel",e.Conversation="conversation"}(o||(o={})),function(e){e.Default="default",e.ModView="mod_view",e.Sunlight="sunligh"}(u||(u={}))},136566:function(e,n,i){"use strict";i.d(n,{FA:function(){return d},QK:function(){return a},V5:function(){return s},hQ:function(){return r},ns:function(){return u},vu:function(){return o}});var t=i(982821);function a(e){return e.type===t.PD.WhisperSent}function r(e){return e.type===t.PD.WhisperReceived}function d(e){return e.type===t.PD.WhisperDeleted}function s(e){return e.type===t.PD.WhisperEdited}function o(e){return e.type===t.PD.WhisperThreadUpdate}function u(e){return e.type===t.PD.WhisperAllThreadsUpdate}}}]);